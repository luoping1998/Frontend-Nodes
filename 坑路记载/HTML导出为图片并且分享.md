# å°† HTML å¯¼å‡ºä¸ºå›¾ç‰‡å¹¶ä¸”åˆ†äº«
> èƒŒæ™¯ï¼šæœ€è¿‘ PM æ¥äº†ä¸€ä¸ªéœ€æ±‚ï¼Œå¦‚ä¸‹ï¼šåœ¨æ‰‹æœºç«¯æ‰“å¼€ã€ç”¨æˆ·ä½¿ç”¨æŠ¥å‘Šï¼ˆä¸€ä¸ªæ ¹æ®ç”¨æˆ· ID è·å–ä¿¡æ¯çš„é™æ€å±•ç¤ºé¡µé¢ï¼‰ã€‘æ—¶ï¼Œå…è®¸ â€œä¿å­˜ä¸ºå›¾ç‰‡â€ å’Œ â€œåˆ†äº«â€ã€‚ğŸ‘Œ å¬åˆ°è¿™ä¸ªéœ€æ±‚çš„å½“ä¸‹ï¼Œæˆ‘æƒ³ç€ç›´æ¥ç”¨ canvas ç”»å‡ºæ¥... å¯æ˜¯ canvas åªèƒ½ç”»å›¾ç‰‡å•Šäº²äº²ã€æ‰¶é¢ã€‘

## æ–¹æ¡ˆ
### æ–¹æ¡ˆä¸€ ä½¿ç”¨ html2canvas æ’ä»¶ï¼ˆçº¯å‰ç«¯æ–¹æ¡ˆï¼‰
é€šè¿‡ä½¿ç”¨ html2canvas æ’ä»¶ï¼Œå°† html ç”»åˆ° canvas ç”»å¸ƒï¼Œç„¶åé€šè¿‡å®ƒçš„ toDataURL/toBlob å¯¼å‡ºä¸º base64 æˆ–è€… blob ï¼Œå†é€šè¿‡aæ ‡ç­¾ download å±æ€§è¿›è¡Œä¸‹è½½
### æ–¹æ¡ˆäºŒï¼ˆåç«¯æ–¹æ¡ˆï¼‰
ç›´æ¥ç”¨ phantom.js æˆ– casper.js ä¹‹ç±»çš„ node æ’ä»¶ï¼Œç”¨ headless WebKit å»æ¨¡æ‹Ÿæ‰“å¼€é¡µé¢ï¼Œç„¶åå¯¼å‡ºä¸ºå›¾ç‰‡/ PDF ï¼Œæ¥ç€ä¸Šä¼ åˆ° OSSï¼ŒæŠŠå¯¹åº”é“¾æ¥è¿”å›ç»™å‰ç«¯ï¼Œå®ç°ä¸‹è½½åŠŸèƒ½ã€‚
### æ–¹æ¡ˆä¸‰ ç¥å¥‡çš„ svg âœ¨
åˆ©ç”¨ svg æ ‡ç­¾ï¼Œå°†è¦ç»˜åˆ¶çš„ HTML ç»“æ„ï¼Œâ€œç»˜åˆ¶â€åˆ° svg æ ‡ç­¾ä¸­ï¼Œæ‹¼æ¥æˆ url ä¼ ç»™ img çš„ src ï¼Œåœ¨å…¶ onload äº‹ä»¶ä¸­åˆ©ç”¨ canvas ç»˜åˆ¶å¹¶è½¬å‡ºæˆ url è¿”å›ã€‚

## å‘è·¯å¼€å¯
### å‰ææ¦‚è¦ï¼ˆå¿…è¦çš„çŸ¥è¯† æ›´å¥½çš„ç†è§£ï¼‰âœˆï¸
- [HTMLã€XML å’Œ XHTML çš„åŒºåˆ«å’Œè”ç³»](./HTML&XML&XHTML.md)
- [SVG? Amazing!](./svg.md)
### å®ç°æ€è·¯ ğŸ’¡
- ä¿å­˜ä¸ºå›¾ç‰‡
> é€šè¿‡å°†è¦â€œå¯¼å‡ºæˆå›¾ç‰‡â€çš„ DOM èŠ‚ç‚¹åŠå…¶å†…éƒ¨çš„å­èŠ‚ç‚¹çš„ CSS æ ·å¼é€šè¿‡ getComputedStyle() æ–¹æ³•è·å–åˆ°ï¼Œç„¶åè®¾ç½®æˆå…ƒç´ å†…è”çš„æ ·å¼ï¼Œç„¶åå°†æ•´ä¸ª DOM æ ‘æ”¾è‡³ XMLSerializer å¯¹è±¡çš„ serializeToString() æ–¹æ³•ä¸­ï¼Œåºåˆ—åŒ–å‡ºå®ƒçš„ç»“æ„å­—ç¬¦ä¸²ï¼Œç„¶åæ’å…¥ `base64:data,xml+svg,${str}` str ä½ç½®ï¼Œç„¶åä½œä¸º img çš„ src å±æ€§å€¼ä¼ å…¥ï¼Œå¹¶åœ¨ img çš„ onload å‡½æ•°ä¸­ç”¨ canvas ç»˜åˆ¶å‡ºéœ€è¦å¤§å°çš„ canvas å¹¶åˆ©ç”¨å…¶ toDataURL()ï¼Œå¯¼å‡ºæœ€åçš„ base64 å­—ç¬¦ä¸²ï¼Œåˆ©ç”¨ a æ ‡ç­¾çš„ download å±æ€§ï¼Œç”Ÿæˆæœ€ç»ˆçš„å›¾ç‰‡ã€‚
- åˆ†äº«

### å‘è·¯è¯¦æƒ… ğŸ”
1. éœ€è¦å°†å…ƒç´ çš„æ ·å¼å†™æˆå†…è”ï¼ˆå› ä¸ºå¯¼å…¥ svg ä¸­çš„æ—¶å€™å…¶å®è¿˜æ˜¯ HTML ä»£ç ï¼Œä½†æ˜¯æ­¤æ—¶çš„æ ·å¼åŸæœ¬æ˜¯åœ¨ css/less çš„æ–‡ä»¶ä¸­çš„ï¼Œè€Œ svg ä»¥ url çš„å½¢å¼ä½œä¸º img çš„ src æ—¶ï¼Œå°±ä¸èƒ½åŠ¨æ€è·å–åˆ°æ ·å¼äº† ğŸ‘Œï¼‰
2. å¯¹äº echarts ç»˜åˆ¶å‡ºçš„ canvasï¼Œç”±äºæœ‰ **åŠ¨ç”»** çš„ç¼˜æ•…ï¼Œåœ¨æœ€å¼€å§‹å¯¼å‡ºçš„æ—¶å€™ä¸ºç©ºç™½ã€‚
> è§£å†³æ–¹æ¡ˆï¼šåœ¨è¯¥ç»„ä»¶ componentDidMount é’©å­å‡½æ•°ä¸­ï¼Œä½¿ç”¨ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥ï¼Œåœ¨ canvas åŠ¨ç”»å®Œæˆåå†å»å¯¼å‡ºå…¶ URLï¼Œå¹¶ä¸”æ–°å»ºä¸€ä¸ª imgï¼Œä¸canvas ç½®äºåŒä¸€ä½ç½®ï¼Œè¾¾åˆ°â€œè¦†ç›–â€æ•ˆæœï¼Œåœ¨å¯¼å‡ºæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸º canvas åˆ™ä¸ç”¨å¯¼å‡ºï¼Œè€Œ image ä¸å—å½±å“ã€‚ï¼ˆé€æ˜åº¦çš„ canvas è¦†ç›–æ—¶ä¼šå‡ºç°é¢œè‰²åŠ æ·±çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œåœ¨æ’å…¥å…ƒç´ æ—¶å¯é€‰æ‹©å°†åŸ canvas â€œéšè—â€æ‰ã€‚
3. å¤´åƒä¸ reaction è¡¨æƒ…å‡ä¸º cdnï¼Œåœ¨å¯¼å‡ºæ—¶å¹¶æ²¡æœ‰å±•ç¤ºå‡ºæœ€ç»ˆæ ·å¼ã€‚
> è§£å†³æ–¹æ¡ˆï¼šç»˜åˆ¶å®Œåå‘ç°è¡¨æƒ…å’Œå¤´åƒå‡ä¸å±•ç¤ºï¼Œå½“ä¸‹çš„æƒ³æ³•ğŸ’¡æ˜¯å°†å›¾ç‰‡ç”¨ canvas ç»˜åˆ¶å‡ºæ¥ï¼Œå¯¼æˆ base64 æ›¿æ¢åŸæ¥çš„ urlã€‚ç„¶åä½ åˆä¼šå‘ç°ä¸‹é¢çš„é—®é¢˜ï¼š
4. canvas ç»˜åˆ¶è·¨åŸŸçš„å›¾ç‰‡ï¼ˆä¾‹å¦‚<img src="http://xxxx.com/yyy/ddd.png"/>ï¼‰æ—¶ï¼Œä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š
```
  Failed to execute 'toDataURL' Tainted canvases may not be exported
  // âŒ è¢«æ±¡æŸ“çš„ canvas ä¸èƒ½ä½¿ç”¨ toDataURL æ–¹æ³•å¯¼å‡º
```
> åŸå› ï¼š canvas å—åˆ°äº†åŒæºç­–ç•¥çš„åˆ¶è£ ğŸ˜¢ï¼Œè™½ç„¶å¯ä»¥ append åˆ°é¡µé¢ä¸Šå±•ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯æ— æ³•ä½¿ç”¨å®ƒçš„ toBlob(), toDataURL() å’Œ getImageData() æ–¹æ³•ã€‚
> è§£å†³æ–¹æ¡ˆï¼šä¸ºå›¾ç‰‡è®¾ç½® crossOrigin å±æ€§ä¸º â€œAnonymous" ï¼ˆç±»ä¼¼äºå‰ç«¯ ajax è·¨åŸŸï¼‰
å‚è€ƒé“¾æ¥ğŸ”—ï¼š[å¯ç”¨äº† cros çš„å›¾ç‰‡](https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image)
[canvas å›¾ç‰‡è·¨åŸŸé—®é¢˜](https://www.zhangxinxu.com/wordpress/2018/02/crossorigin-canvas-getimagedata-cors/)